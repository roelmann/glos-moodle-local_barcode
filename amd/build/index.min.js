define(["jquery","core/str"],function(a,b){function c(){a(".path-local-barcode #id_barcode").focus(),a(".path-local-barcode #id_barcode").keypress(function(a){var b=a.which||a.keyCode;if(13===b)return a.stopPropagation(),a.preventDefault(),o(),q(),d(a),!1}),a(".path-local-barcode #id_submitbutton").on("click",function(a){return a.stopPropagation(),a.preventDefault(),o(),q(),d(a),!1}),t();var c=b.get_strings([{key:"assignmentdetails",component:"local_barcode"},{key:"barcodes",component:"local_barcode"},{key:"draft",component:"local_barcode"},{key:"draftandsubmissionerror",component:"local_barcode"},{key:"due",component:"local_barcode"},{key:"notsubmitted",component:"local_barcode"},{key:"scanned",component:"local_barcode"},{key:"student",component:"local_barcode"},{key:"submitted",component:"local_barcode"}]);a.when(c).done(function(a){N=a,j()})}function d(b){b.stopPropagation(),b.preventDefault();var c=e();return c&&!g()&&(a("#feedback").html(N[3]),a("#feedback-group").addClass("local-barcode-has-inform"),a("#feedback-group").removeClass("local-barcode-has-danger"),a("#feedback-group").removeClass("local-barcode-has-success")),c&&g()&&h(c),a(".path-local-barcode #id_barcode").focus(),!1}function e(){return a(".path-local-barcode #id_barcode").val().trim()}function f(){a(".path-local-barcode #id_barcode").val("")}function g(){return"0"===K||"0"===L}function h(b){var c="service/upload.php?barcode=";x&&(c="../service/upload.php?barcode="),a.ajax({type:"POST",url:c+b+"&id="+w+"&revert="+K+"&ontime="+L,data:{barcode:b},success:function(a){"undefined"!=typeof a.faultCode?(y=a.faultString,G=a.faultString):(y=a.data.code,G=a.data.message,H=a.data.assignment,I=a.data.assignmentdescription,z=a.data.course,A=a.data.duedate,B=a.data.idformat,C=a.data.studentid,D=a.data.studentname,E=a.data.submissiontime,F=a.data.islate,M=a.data.reverted,s()||(p(),r())),i()},error:function(a){G=a.data.message},dataType:"json"})}function i(){var b=a("#feedback");b.html(G);var c=0;200===y&&(M?(J=N[2],a("#feedback-group").addClass("local-barcode-has-success"),a("#feedback-group").removeClass("local-barcode-has-danger"),a("#feedback-group").removeClass("local-barcode-has-inform"),k("revert")):(J=N[8],a("#feedback-group").removeClass("local-barcode-has-danger"),a("#feedback-group").removeClass("local-barcode-has-inform"),a("#feedback-group").addClass("local-barcode-has-success"),k("success"))),404===y&&(H="-"),200!==y&&(J=N[6],a("#feedback-group").removeClass("local-barcode-has-success"),a("#feedback-group").removeClass("local-barcode-has-inform"),a("#feedback-group").addClass("local-barcode-has-danger"),k("fail"),c=1),f(),u(c)}function j(){var b=a("#region-main"),c=a("<table></table>");c.attr("id","local-barcode-table"),c.addClass("generaltable"),c.addClass("local-barcode-table");var d=c.append("<thead></thead>"),e=d.append("<tr></tr>");e.html('<th colspan="8" class="local-barcode-th-left local-barcode-sm-hide">'+N[1]+' - (<span id="local_barcode_id_count">0</span> '+N[6]+')</th><th colspan="17" class="local-barcode-th-center">'+N[0]+'</th><th colspan="5" class="local-barcode-th-right">'+N[8]+'(<span id="local_barcode_id_submit_count">0</span>)</th>'),c.append('<tbody id="tbody"></tbody>'),b.append(c)}function k(b){for(var c="local-barcode-"+b,d=[8,17,5],e=l(),f=a("#tbody"),g=a("<tr></tr>"),h=0;h<=2;h++){var i=a("<td></td>"),j=a("<span></span>");i.attr("colspan",d[h]),j.html(e[h]),i.append(j),0===h&&i.addClass("local-barcode-sm-hide"),2===h&&(c+=" local-barcode-td-position",j.addClass("local-barcode-visuallyhidden"),i.addClass(c)),g.append(i)}f.prepend(g)}function l(){var a="local-barcode-ontime";return F&&(a="local-barcode-islate"),[e(),H+"<br /><small>"+I.substring(0,30)+"</small><br /><small>"+z+"</small><br /><small>"+N[7]+": "+D+" / "+B+": "+C+"</small><br /><small>"+N[4]+": "+A+"&nbsp; "+N[6]+': <span class="'+a+'">'+E+"</span></small><br />",J]}function m(b){return a("#local_barcode_id_count").html(b),a("#local_barcode_id_scanned_count").html(b),!1}function n(b){return a("#local_barcode_id_submit_count").html(b),a("#local_barcode_id_submitted_count").html(b),!1}function o(){K=a(".path-local-barcode #id_reverttodraft").is(":checked")?"1":"0"}function p(){a(".path-local-barcode #id_reverttodraft").prop("checked",!1)}function q(){L=a(".path-local-barcode #id_submitontime")&&a(".path-local-barcode #id_submitontime").is("checked")?"1":"0"}function r(){a(".path-local-barcode #id_submitontime").prop("checked",!1)}function s(){return a(".path-local-barcode #id_multiplescans").is("checked")}function t(){a(".path-local-barcode #id_barcode").after(function(){return'<span class="local-barcode-combined-counts local-barcode-inform-inline">(<span id="local_barcode_id_scanned_count">0</span> / <span id="local_barcode_id_submitted_count">0</span>)</span>'})}function u(b){var c,d=O();1!==b||a("#local_barcode_id_submitted_count").hasClass("local-barcode-error-inline")||v(),0===b&&(c=P(),n(c)),a("#local_barcode_id_scanned_count").hasClass("local-barcode-success-inline")||a("#local_barcode_id_scanned_count").addClass("local-barcode-success-inline"),m(d)}function v(){a("#local_barcode_id_submitted_count").addClass("local-barcode-error-inline")}var w,x,y,z,A,B,C,D,E,F,G="",H="-",I="",J="Not Submitted",K="0",L="0",M=0,N=[],O=function(){function a(){b+=1}var b=0;return function(){return a(),b}}(),P=function(){function a(){b+=1}var b=0;return function(){return a(),b}}();return{init:function(a,b){c(),w=a,x=b}}});